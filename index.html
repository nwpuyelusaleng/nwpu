
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>药品查找</title>
<style>
#myInput{
	background-image:url('https://static.runoob.com/images/mix/searchicon.png');
	background-position:10px 12px;
	background-repeat:no-repeat;
	width:100%;
	font-size:16px;
	padding:12px 20px 12px 40px;
	border:1px solid #ddd;
	margin-bottom:12px;
}

#s1,#s2{
	width:30%;
	font-size:16px;
	padding:12px 20px 12px 40px;
	border:1px solid #ddd;
	margin-bottom:12px;
}
#b1,#b2,#b3,#b4{
	width:30%;
	font-size:16px;
	padding:12px 20px 12px 40px;
	border:1px solid #ddd;
	margin-bottom:12px;
}
	

#myTable{
	border-collapse:collapse;
	width:100%;
	border:1px solid #ddd;
	font-size:18px;
}

#myTable th,#myTable td{
	text-align:left;
	padding:12px;
}

#myTable tr{
	border-bottom:1px solid #ddd;
}

#myTable tr.header,#myTable tr:hover {
	background-color:#f1f1f1;
}
</style>

<script>

/*window.onbeforeonload()=function(){
	return('请不要刷新，后退！');
}*/

function myFunction(){
	var input,filter,table,tr,td,i;
	input=document.getElementById("myInput");
	filter=input.value.toUpperCase();
	table=document.getElementById("myTable");
	tr=table.getElementsByTagName("tr");
	
	for (i=0;i<tr.length;i++){
		td=tr[i].getElementsByTagName("td")[0];
		if (td){
			if (td.innerHTML.toUpperCase().indexOf(filter)>-1)
			{
				tr[i].style.display="";
			}
			else{
				tr[i].style.display="none";
			}
		}
	}
}

function saveFile(){
	var table=document.getElementById("myTable");
	var tbody=table.getElementsByTagName("tbody")[0];
	var str="";
	
	for (var i=1;i<tbody.rows.length;i++){
		for (var j=0;j<tbody.rows[i].cells.length;j++){
			
		str+=tbody.rows[i].cells[j].innerHTML;
		if (j<4){
			str+=",";
		}
		}
		str+="!";
	}
	var fso;
	try { 
	fso=new ActiveXObject("Scripting.FileSystemObject"); 
	
	} catch (e) { 
	alert("当前浏览器不支持");
	return;
	} 
	
	
	var f1 = fso.createtextfile("E:\\1.txt",true);
	f1.write(str);
	alert("文件已保存");
}

function readFile(){
	var table=document.getElementById("myTable");
	 var fso;
	try { 
	fso=new ActiveXObject("Scripting.FileSystemObject"); 
	
	} catch (e) { 
	alert("当前浏览器不支持");
	return;
	}  
	var openf1 = fso.OpenTextFile("E:\\1.txt");
	
	var str = openf1.ReadLine();
	var str1=str.split("!");
	
	for (var t=0;t<str1.length-1;t++){
		var str2=str1[t].split(",");
		
		var oTr=document.createElement('tr');
		var oTd=document.createElement('td');
		oTd.innerHTML=str2[0];
		oTr.appendChild(oTd);
		
		var oTd=document.createElement('td');
		oTd.innerHTML=str2[1];
		oTr.appendChild(oTd);
		
		var oTd=document.createElement('td');
		oTd.innerHTML=str2[2];
		oTr.appendChild(oTd);
			
		var oTd=document.createElement('td');
		oTd.innerHTML=str2[3];
		oTr.appendChild(oTd);
		
		var oTd=document.createElement('td');
		oTd.innerHTML=str2[4].toString();
		oTr.appendChild(oTd);
		
		table.tBodies[0].appendChild(oTr);}
		alert("文件导入成功！");
			
}

window.onload=function(){
	var ob1=document.getElementById("b1");
	
	var ob2=document.getElementById("b2");
	
	var os1=document.getElementById("s1");
	
	var os2=document.getElementById("s2");
	
	var table=document.getElementById("myTable");
	
	/*for (var i=1;i<31;i++){
	document.getElementById("amount").options[i]=new Option(i);
	}*/

    ob1.onclick=function(){
		var cas=os1.value;
		
		var oTr=document.createElement('tr');
		
		var room=document.getElementById("room").options[document.getElementById("room").selectedIndex].text;
		
		var pos=document.getElementById("position").options[document.getElementById("position").selectedIndex].text;
		
		var amount=document.getElementById("amount").options[document.getElementById("amount").selectedIndex].text;
		for (var i=0;i<table.tBodies[0].rows.length;i++){
			var scas=table.tBodies[0].rows[i].cells[0].innerHTML;
			var sroom=table.tBodies[0].rows[i].cells[2].innerHTML;
			var spos=table.tBodies[0].rows[i].cells[3].innerHTML;
		if (cas==scas && room==sroom && pos==spos){
			 var k=parseInt(table.tBodies[0].rows[i].cells[4].innerHTML);
				 k+=parseInt(amount);
				 table.tBodies[0].rows[i].cells[4].innerHTML=k.toString();
				 break;}
				 }
				 
	if(i==table.tBodies[0].rows.length){
			
		var oTd=document.createElement('td');
		oTd.innerHTML=os1.value;
		oTr.appendChild(oTd);
		
		var oTd=document.createElement('td');
		oTd.innerHTML=os2.value;
		oTr.appendChild(oTd);
		
		var oTd=document.createElement('td');
		oTd.innerHTML=room;
		oTr.appendChild(oTd);
			
		var oTd=document.createElement('td');
		oTd.innerHTML=pos;
		oTr.appendChild(oTd);
		
		var oTd=document.createElement('td');
		oTd.innerHTML=amount;
		oTr.appendChild(oTd);
		
		table.tBodies[0].appendChild(oTr);}
		
		alert("操作成功！")
}

	ob2.onclick=function(){
		var cas=os1.value;
		var pos=document.getElementById("position").options[document.getElementById("position").selectedIndex].text
		var room=document.getElementById("room").options[document.getElementById("room").selectedIndex].text;
		var amount=document.getElementById("amount").options[document.getElementById("amount").selectedIndex].text;
		for (var i=0;i<table.tBodies[0].rows.length;i++){
			var scas=table.tBodies[0].rows[i].cells[0].innerHTML;
			var sroom=table.tBodies[0].rows[i].cells[2].innerHTML;
			var spos=table.tBodies[0].rows[i].cells[3].innerHTML;
			if (cas==scas && room==sroom && pos==spos){
				 var k=parseInt(table.tBodies[0].rows[i].cells[4].innerHTML);
				 if (k>amount){
				 k-=amount;
				 table.tBodies[0].rows[i].cells[4].innerHTML=k.toString();
				 }
				 else{
				 table.tBodies[0].removeChild(table.tBodies[0].rows[i]);
				 }
			}
		}
		alert("操作成功！")
	}
}
</script>
</head>

<body>
<div align="left">
  <input type="text" id="myInput" onkeyup="myFunction()" placeholder="搜索CAS号..." />
  <input type="text" id="s1" placeholder="输入CAS号" />&nbsp;&nbsp;
  <input type="text" id="s2" placeholder="输入药品名" />
</div>

<h2>选择实验室&nbsp;&nbsp;<select id="room" style="width:100px;">
    <option value=""></option>
    <option value="1">413</option>
    <option value="2">414</option>
    <option value="3">415</option>
</select>

&nbsp;&nbsp;

选择位置&nbsp;&nbsp;<select id="position" style="width:100px;">
    <option value=""></option>
    <option value="1">A</option>
    <option value="2">B</option>
    <option value="3">C</option>
    <option value="4">D</option>
</select>

&nbsp;&nbsp;

选择数量&nbsp;&nbsp;<select id="amount" style="width:100px;">
    <option value=""></option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
</select>

</h2>

  <div align="left"><br />
  
    <input type="button" id="b1" style="background:#FF0" value="新增" />
    &nbsp; 
    &nbsp; 
    &nbsp; 
    &nbsp; 
    <input type="button" id="b2" style="background:#0F0" value="减少" /><br />
    <input type="button" id="b3" onclick="readFile()" style="background:#0FF" value="读取文件(刷新了之后按，其他时间不要按)" />
     &nbsp; 
    &nbsp; 
    &nbsp; 
    &nbsp; 
    <input type="button" id="b4" onclick="saveFile()" style="background:#F0F" value="保存文件(退出之前必点，不然数据全没了)" />
  </div>
  
<table id="myTable">
  <tr class="header">
<th style="width:20%;">CAS号</th>
<th style="width:20%;">药品名</th>
<th style="width:20%;">实验室</th>
<th style="width:20%;">位置</th>
<th style="width:20%;">数量</th>
</tr>
</table>
</body>
</html>


